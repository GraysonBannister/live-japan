{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/graysonbannister/Documents/live-japan/app/components/PropertyMap.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef, useMemo } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport 'leaflet.markercluster/dist/MarkerCluster.css';\nimport 'leaflet.markercluster/dist/MarkerCluster.Default.css';\nimport 'leaflet.markercluster';\nimport Link from 'next/link';\nimport { Property } from '../types/property';\n\ninterface PropertyMapProps {\n  properties: Property[];\n  onMarkerClick?: (property: Property) => void;\n}\n\n// Fix Leaflet default marker icons in Next.js\nconst fixLeafletIcons = () => {\n  delete (L.Icon.Default.prototype as unknown as { _getIconUrl?: () => string })._getIconUrl;\n  \n  L.Icon.Default.mergeOptions({\n    iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png',\n    iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',\n    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',\n  });\n};\n\n// Create custom marker icon based on property type\nconst createPropertyIcon = (type: string, price: number) => {\n  const getColor = () => {\n    switch (type) {\n      case 'monthly_mansion':\n        return '#3B82F6'; // blue\n      case 'weekly_mansion':\n        return '#10B981'; // green\n      case 'apartment':\n        return '#8B5CF6'; // purple\n      default:\n        return '#6B7280'; // gray\n    }\n  };\n\n  const color = getColor();\n  const priceText = price >= 100000 \n    ? `¬•${(price / 10000).toFixed(0)}‰∏á` \n    : `¬•${(price / 1000).toFixed(0)}K`;\n\n  return L.divIcon({\n    className: 'custom-marker',\n    html: `\n      <div style=\"\n        background-color: ${color};\n        color: white;\n        padding: 4px 8px;\n        border-radius: 16px;\n        font-size: 11px;\n        font-weight: 600;\n        white-space: nowrap;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n        border: 2px solid white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        min-width: 50px;\n      \">\n        ${priceText}\n      </div>\n    `,\n    iconSize: [60, 30],\n    iconAnchor: [30, 15],\n    popupAnchor: [0, -15],\n  });\n};\n\n// Marker Cluster Group component\nfunction MarkerClusterGroup({ properties }: { properties: Property[] }) {\n  const map = useMap();\n  const clusterRef = useRef<L.MarkerClusterGroup | null>(null);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    // Initialize marker cluster group\n    const markerCluster = L.markerClusterGroup({\n      chunkedLoading: true,\n      spiderfyOnMaxZoom: true,\n      showCoverageOnHover: true,\n      zoomToBoundsOnClick: true,\n      maxClusterRadius: 80,\n      iconCreateFunction: (cluster) => {\n        const childCount = cluster.getChildCount();\n        let size = 'small';\n        let color = '#3B82F6';\n        \n        if (childCount >= 100) {\n          size = 'large';\n          color = '#DC2626';\n        } else if (childCount >= 50) {\n          size = 'large';\n          color = '#EF4444';\n        } else if (childCount >= 20) {\n          size = 'medium';\n          color = '#F59E0B';\n        }\n\n        const sizePx = size === 'large' ? 50 : size === 'medium' ? 40 : 30;\n        \n        return L.divIcon({\n          html: `<div style=\"\n            background-color: ${color};\n            width: ${sizePx}px;\n            height: ${sizePx}px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-weight: 700;\n            font-size: ${size === 'large' ? '14px' : '12px'};\n            border: 3px solid white;\n            box-shadow: 0 2px 6px rgba(0,0,0,0.3);\n          \">${childCount}</div>`,\n          className: 'marker-cluster',\n          iconSize: L.point(sizePx, sizePx),\n        });\n      },\n    });\n\n    clusterRef.current = markerCluster;\n    map.addLayer(markerCluster);\n\n    return () => {\n      if (clusterRef.current) {\n        map.removeLayer(clusterRef.current);\n      }\n    };\n  }, [map]);\n\n  useEffect(() => {\n    if (!clusterRef.current) return;\n\n    // Clear existing markers\n    clusterRef.current.clearLayers();\n\n    // Add markers for each property\n    const markers: L.Marker[] = [];\n    properties.forEach((property) => {\n      if (!property.lat || !property.lng) return;\n\n      const marker = L.marker([property.lat, property.lng], {\n        icon: createPropertyIcon(property.type, property.price),\n      });\n\n      const popupContent = document.createElement('div');\n      popupContent.innerHTML = `\n        <div style=\"min-width: 200px; font-family: system-ui, sans-serif;\">\n          <div style=\"position: relative; margin: -12px -12px 8px -12px;\">\n            <img \n              src=\"${property.photos?.[0] || '/placeholder-property.jpg'}\" \n              alt=\"${property.location}\"\n              style=\"width: 100%; height: 100px; object-fit: cover; border-radius: 4px 4px 0 0;\"\n            />\n            ${property.furnished ? '<span style=\"position: absolute; top: 4px; left: 4px; background: #10B981; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;\">Furnished</span>' : ''}\n          </div>\n          <h3 style=\"margin: 0 0 4px 0; font-size: 14px; font-weight: 600;\">${property.location}</h3>\n          <p style=\"margin: 0 0 4px 0; font-size: 16px; font-weight: 700; color: #3B82F6;\">\n            ¬•${property.price.toLocaleString()}/month\n          </p>\n          <p style=\"margin: 0 0 8px 0; font-size: 12px; color: #6B7280;\">\n            ${property.nearestStation} ‚Ä¢ ${property.walkTime} min walk\n          </p>\n          <a \n            href=\"/property/${property.id}\" \n            style=\"\n              display: block; \n              text-align: center; \n              background: #3B82F6; \n              color: white; \n              padding: 6px 12px; \n              border-radius: 6px; \n              text-decoration: none; \n              font-size: 12px;\n              font-weight: 500;\n            \"\n          >\n            View Details ‚Üí\n          </a>\n        </div>\n      `;\n\n      marker.bindPopup(popupContent);\n      markers.push(marker);\n    });\n\n    clusterRef.current.addLayers(markers);\n  }, [properties]);\n\n  return null;\n}\n\n// Map bounds fitter\nfunction MapBoundsFitter({ properties }: { properties: Property[] }) {\n  const map = useMap();\n\n  useEffect(() => {\n    if (properties.length === 0) return;\n\n    const validProperties = properties.filter(p => p.lat && p.lng);\n    if (validProperties.length === 0) return;\n\n    if (validProperties.length === 1) {\n      map.setView([validProperties[0].lat, validProperties[0].lng], 15);\n    } else {\n      const bounds = L.latLngBounds(\n        validProperties.map(p => [p.lat, p.lng])\n      );\n      map.fitBounds(bounds, { padding: [50, 50], maxZoom: 16 });\n    }\n  }, [map, properties]);\n\n  return null;\n}\n\nexport default function PropertyMap({ properties }: PropertyMapProps) {\n  useEffect(() => {\n    fixLeafletIcons();\n  }, []);\n\n  // Default to Tokyo center\n  const defaultCenter: [number, number] = [35.6762, 139.6503];\n\n  const validProperties = useMemo(() => \n    properties.filter(p => p.lat && p.lng),\n    [properties]\n  );\n\n  if (validProperties.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-[500px] bg-gray-100 rounded-xl\">\n        <div className=\"text-center\">\n          <div className=\"text-4xl mb-2\">üó∫Ô∏è</div>\n          <p className=\"text-gray-600\">No properties with location data found</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full h-[50vh] md:h-[600px] min-h-[300px] rounded-xl overflow-hidden shadow-lg border border-gray-200\">\n      <MapContainer\n        center={defaultCenter}\n        zoom={12}\n        scrollWheelZoom={true}\n        style={{ height: '100%', width: '100%' }}\n      >\n        <TileLayer\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        <MarkerClusterGroup properties={validProperties} />\n        <MapBoundsFitter properties={validProperties} />\n      </MapContainer>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}