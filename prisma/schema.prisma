// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Property {
  id                       Int       @id @default(autoincrement())
  externalId               String?   @unique
  sourceUrl                String?   @unique
  type                     String
  price                    Int
  deposit                  Int?
  keyMoney                 Int?
  nearestStation           String
  walkTime                 Int
  furnished                Boolean
  foreignerFriendly        Boolean
  rooms                    Float?
  sizeSqm                  Float?
  photos                   Json
  descriptionEn            String
  descriptionJp            String?
  location                 String
  lat                      Float?
  lng                      Float?
  availableFrom            DateTime?
  updatedAt                DateTime  @default(now()) @updatedAt
  createdAt                DateTime  @default(now())
  pricingPlans             Json?
  tags                     Json?
  autoHideAfter            DateTime?
  availabilityStatus       String    @default("unknown")
  clickCount               Int       @default(0)
  contentHash              String?
  inquiryCount             Int       @default(0)
  isActive                 Boolean   @default(true)
  lastConfirmedAvailableAt DateTime?
  lastContentChangeAt      DateTime?
  lastInquiryAt            DateTime?
  lastScrapedAt            DateTime?
  partnerFeed              Boolean   @default(false)
  sourceLastUpdatedAt      DateTime?
  statusConfidenceScore    Int       @default(50)
  verificationStatus       String    @default("unverified")

  listItems ListItem[]
}

model List {
  id          Int      @id @default(autoincrement())
  userId      String
  name        String
  description String?
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt

  items ListItem[]

  @@index([userId])
}

model ListItem {
  id         Int      @id @default(autoincrement())
  listId     Int
  propertyId Int
  notes      String?
  createdAt  DateTime @default(now())

  list     List     @relation(fields: [listId], references: [id], onDelete: Cascade)
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([listId, propertyId])
  @@index([listId])
  @@index([propertyId])
}
